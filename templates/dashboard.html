{% extends 'base.html' %}
{% block content %}

<div class="card border-0 shadow-sm mb-4 overflow-hidden position-relative" style="background: linear-gradient(135deg, #005eb8 0%, #004485 100%); color: white;">
    <div class="position-absolute rounded-circle bg-white opacity-10" style="width: 200px; height: 200px; top: -50px; right: -50px; opacity: 0.1;"></div>
    <div class="position-absolute rounded-circle bg-white opacity-10" style="width: 100px; height: 100px; bottom: -20px; left: 20%; opacity: 0.05;"></div>

    <div class="card-body p-4 d-flex justify-content-between align-items-center position-relative z-1">
        <div>
            <h4 class="fw-bold mb-1">Sistem Informasi Akuntansi</h4>
            <p class="mb-0 opacity-75 fw-light">Laporan Keuangan PT Blue Bird Tbk &mdash; Periode Q3 2025</p>
        </div>
        <div class="text-end border-start border-white border-opacity-25 ps-4 d-none d-md-block">
            <h2 class="fw-bold mb-0" id="clock" style="font-family: 'Courier New', monospace; letter-spacing: -1px;">00:00:00</h2>
            <small id="date" class="opacity-75">Memuat Tanggal...</small>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="card h-100 border-start border-4 border-primary shadow-sm hover-effect">
            <div class="card-body d-flex align-items-center justify-content-between p-3"> <div class="flex-grow-1 overflow-hidden"> <p class="text-muted mb-1 small fw-bold text-uppercase">Total Debit</p>
                    <h5 class="fw-bold text-dark mb-0 text-nowrap responsive-text">
                        <span class="text-secondary fw-normal small me-1" style="font-size: 0.7em;">Rp</span>{{ "{:,.0f}".format(t_debit).replace(',', '.') }}
                    </h5>
                </div>
                <div class="bg-primary bg-opacity-10 p-2 rounded text-primary fs-4 ms-2 flex-shrink-0">
                    <i class="fa-solid fa-arrow-trend-up"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card h-100 border-start border-4 border-danger shadow-sm hover-effect">
            <div class="card-body d-flex align-items-center justify-content-between p-3">
                <div class="flex-grow-1 overflow-hidden">
                    <p class="text-muted mb-1 small fw-bold text-uppercase">Total Kredit</p>
                    <h5 class="fw-bold text-dark mb-0 text-nowrap responsive-text">
                        <span class="text-secondary fw-normal small me-1" style="font-size: 0.7em;">Rp</span>{{ "{:,.0f}".format(t_kredit).replace(',', '.') }}
                    </h5>
                </div>
                <div class="bg-danger bg-opacity-10 p-2 rounded text-danger fs-4 ms-2 flex-shrink-0">
                    <i class="fa-solid fa-arrow-trend-down"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card h-100 border-start border-4 border-success shadow-sm hover-effect">
            <div class="card-body d-flex align-items-center justify-content-between p-3">
                <div class="flex-grow-1 overflow-hidden">
                    <p class="text-muted mb-1 small fw-bold text-uppercase">Laba Bersih (Q3)</p>
                    <h5 class="fw-bold {{ 'text-success' if laba_bersih >= 0 else 'text-danger' }} mb-0 text-nowrap responsive-text">
                        <span class="text-secondary fw-normal small me-1" style="font-size: 0.7em;">Rp</span>{{ "{:,.0f}".format(laba_bersih).replace(',', '.') }}
                    </h5>
                </div>
                <div class="bg-success bg-opacity-10 p-2 rounded text-success fs-4 ms-2 flex-shrink-0">
                    <i class="fa-solid fa-money-bill-trend-up"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card h-100 border-start border-4 border-info shadow-sm hover-effect">
            <div class="card-body d-flex align-items-center justify-content-between p-3">
                <div class="flex-grow-1 overflow-hidden">
                    <p class="text-muted mb-1 small fw-bold text-uppercase">Saldo Kas & Bank</p>
                    <h5 class="fw-bold text-dark mb-0 text-nowrap responsive-text">
                        <span class="text-secondary fw-normal small me-1" style="font-size: 0.7em;">Rp</span>{{ "{:,.0f}".format(saldo_kas).replace(',', '.') }}
                    </h5>
                </div>
                <div class="bg-info bg-opacity-10 p-2 rounded text-info fs-4 ms-2 flex-shrink-0">
                    <i class="fa-solid fa-wallet"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-7">
        <div class="card h-100 shadow-sm">
            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                <h6 class="m-0 fw-bold text-primary">Tren Arus Kas (7 Hari Terakhir)</h6>
            </div>
            <div class="card-body">
                <div style="height: 300px; position: relative;">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="card h-100 shadow-sm">
            <div class="card-header bg-white py-3">
                <h6 class="m-0 fw-bold text-primary">Performa Laba Rugi</h6>
            </div>
            <div class="card-body">
                <div style="height: 300px; position: relative;">
                    <canvas id="barChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="card h-100 shadow-sm">
            <div class="card-header bg-white py-3">
                <h6 class="m-0 fw-bold text-primary">Komposisi Aset Perusahaan</h6>
            </div>
            <div class="card-body">
                <div style="height: 300px; position: relative;">
                    <canvas id="pieChart"></canvas>
                </div>
                <p class="text-center text-muted small mt-3">Menampilkan proporsi Kas, Bank, Piutang, dan Aset Tetap.</p>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="card h-100 shadow-sm border-0 bg-light">
            <div class="card-body d-flex flex-column justify-content-center align-items-center text-center p-5">
                <div class="bg-white p-4 rounded-circle shadow-sm mb-3 text-primary">
                    <i class="fa-solid fa-file-invoice-dollar fa-3x"></i>
                </div>
                <h5 class="fw-bold text-dark">Laporan Keuangan Siap</h5>
                <p class="text-muted mb-4">Seluruh data transaksi telah terintegrasi ke dalam Laporan Laba Rugi, Posisi Keuangan, Perubahan Ekuitas, dan Arus Kas.</p>
                <a href="{{ url_for('laporan_default') }}" class="btn btn-primary px-4 py-2 rounded-pill fw-bold shadow-sm">
                    <i class="fas fa-eye me-2"></i> Lihat Laporan Lengkap
                </a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // --- JAM DIGITAL ---
    function updateClock() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' }).replace(/\./g, ':');
        document.getElementById('clock').textContent = timeString;
        
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('date').textContent = now.toLocaleDateString('id-ID', options);
    }
    setInterval(updateClock, 1000);
    updateClock();

    // --- CHART CONFIG ---
    Chart.defaults.font.family = "'Poppins', sans-serif";
    Chart.defaults.color = '#858796';

    // 1. LINE CHART
    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: {{ line_labels|safe }},
            datasets: [{
                label: 'Arus Kas (Flow)',
                data: {{ line_values|safe }},
                borderColor: '#005eb8',
                backgroundColor: 'rgba(0, 94, 184, 0.05)',
                pointBackgroundColor: '#fff',
                pointBorderColor: '#005eb8',
                fill: true, tension: 0.4, borderWidth: 2
            }]
        },
        options: {
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                x: { grid: { display: false } },
                y: { grid: { borderDash: [5, 5], color: '#e3e6f0' } }
            }
        }
    });

    // 2. BAR CHART
    new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
            labels: {{ bar_label|safe }},
            datasets: [{
                label: 'Nominal (Rp)',
                data: {{ bar_data|safe }},
                backgroundColor: ['#1cc88a', '#e74a3b'],
                borderRadius: 5,
                barThickness: 50
            }]
        },
        options: {
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { borderDash: [5, 5] } },
                x: { grid: { display: false } }
            }
        }
    });

    // 3. PIE CHART
    const pieDataValues = {{ pie_values|safe }};
    const pieDataLabels = {{ pie_labels|safe }};
    
    if (pieDataValues.length === 0) {
        document.getElementById('pieChart').parentNode.innerHTML = '<div class="text-center text-muted"><i class="fa-solid fa-chart-pie fa-2x mb-2 opacity-50"></i><br><small>Belum ada data aset.</small></div>';
    } else {
        new Chart(document.getElementById('pieChart'), {
            type: 'doughnut',
            data: {
                labels: pieDataLabels,
                datasets: [{
                    data: pieDataValues,
                    backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796'],
                    hoverOffset: 4,
                    borderWidth: 0
                }]
            },
            options: {
                maintainAspectRatio: false,
                cutout: '65%',
                plugins: { 
                    legend: { position: 'right', labels: { usePointStyle: true, boxWidth: 10 } } 
                }
            }
        });
    }
</script>

<style>
    .hover-effect { transition: transform 0.2s; }
    .hover-effect:hover { transform: translateY(-5px); }
    
    /* CSS Tambahan: Agar angka mengecil otomatis jika layar sempit */
    @media (max-width: 1400px) {
        .responsive-text { font-size: 1.1rem !important; }
    }
</style>
{% endblock %}